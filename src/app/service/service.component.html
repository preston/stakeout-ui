@if (service(); as s) {
  <div
    [class.wide-service]="settingsService.displayMode() === 'wide'"
    [class.overlay-service]="settingsService.displayMode() === 'overlay'"
  >
    <div
      class="crop"
      [class.has_screenshot]="s.http_screenshot && settingsService.screenshots()"
    >
      @if (s.http_screenshot && settingsService.screenshots()) {
        <img
          [src]="'data:image/jpeg;base64, ' + s.http_screenshot"
          alt=""
        />
      }
      @if (!(s.http_screenshot && settingsService.screenshots())) {
        <div class="healthLevel">
          <div class="level" [class]="statusLevel(s)"></div>
        </div>
      }
    </div>

    <div class="details align-top">
      <h4 class="align-center mb-0 pb-0">
        @if (editable()) {
          @if (!editing()) {
            <button
              class="btn btn-sm btn-outline-secondary float-end"
              role="button"
              (click)="editing.set(true)"
            >
              <span class="bi-pencil"></span>
            </button>
          }
          @if (editing()) {
            <button
              class="btn btn-sm btn-outline-secondary float-end"
              role="button"
              (click)="editing.set(false)"
            >
              <span class="bi bi-x"></span> Close
            </button>
          }
        }
        <span>{{ s.name }}</span>
      </h4>

      <div class="badges">
        @if (s.http && s.http_path_last) {
          <a [href]="'http://' + s.host + s.http_path" target="_blank">
            <span class="badge m-1 rounded-pill text-bg-success">HTTP</span>
          </a>
        }
        @if (s.http && !s.http_path_last) {
          <a [href]="'http://' + s.host + s.http_path" target="_blank">
            <span class="badge m-1 rounded-pill text-bg-danger">HTTP</span>
          </a>
        }
        @if (s.https && s.https_path_last) {
          <a [href]="'https://' + s.host + s.http_path" target="_blank">
            <span class="badge m-1 rounded-pill text-bg-success">HTTPS</span>
          </a>
        }
        @if (s.https && !s.https_path_last) {
          <a [href]="'https://' + s.host + s.http_path" target="_blank">
            <span class="badge m-1 rounded-pill text-bg-danger">HTTPS</span>
          </a>
        }
        @if (s.checked_at) {
          <p class="checked_at ms-1">checked {{ s.checked_at | amTimeAgo }}</p>
        }
        @if (!s.checked_at) {
          <p class="checked_at ms-1">pending service check</p>
        }
      </div>
    </div>

    @if (editable()) {
      @if (editing()) {
        <div class="m-2">
          <form (submit)="update(s)" role="form" class="form row">
            <div class="col-sm-6">
              <label class="form-label" for="service_name">Name</label>
              <div class="input-group">
                <input
                  class="form-control form-control-sm"
                  type="text"
                  name="service_name"
                  [(ngModel)]="s.name"
                  autofocus
                  placeholder="My Service"
                  required
                />
              </div>
              <label class="form-label mt-2" for="service_host">Host</label>
              <div class="input-group mb-2">
                <input
                  class="form-control form-control-sm"
                  type="text"
                  name="service_host"
                  [(ngModel)]="s.host"
                  placeholder="example.com"
                  required
                />
              </div>
              @if (s.http || s.https) {
                <label class="form-label mt-2" for="service_http_path"
                  >HTTP(S) Path (optional)</label
                >
                <div class="input-group mb-2">
                  <input
                    class="form-control form-control-sm"
                    type="text"
                    name="service_http_path"
                    [(ngModel)]="s.http_path"
                    required
                  />
                </div>
              }
              @if (s.http || s.https) {
                <label class="form-label mt-2" for="service_port"
                  >Alternate HTTP(S) Port</label
                >
                <div class="input-group mb-2">
                  <input
                    class="form-control form-control-sm"
                    type="text"
                    name="service_port"
                    [(ngModel)]="s.port"
                    required
                  />
                </div>
                <small class="fw-lighter">'0' uses defaults</small>
              }
            </div>
            <div class="col-sm-6">
              <label class="form-label">Protocols</label>
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  name="service_http"
                  id="service_http"
                  [(ngModel)]="s.http"
                />
                <label class="form-check-label" for="service_http">HTTP</label>
              </div>
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  name="service_https"
                  id="service_https"
                  [(ngModel)]="s.https"
                />
                <label class="form-check-label" for="service_https"
                  >HTTPS</label
                >
              </div>
              <hr />
              @if (s.http || s.https) {
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    name="service_http_preview"
                    id="service_http_preview"
                    [(ngModel)]="s.http_preview"
                  />
                  <label class="form-check-label" for="service_http_preview"
                    >Capture HTTP(S) Preview?</label
                  >
                </div>
              }
            </div>
            <div class="btn-group my-2">
              <button class="btn btn-primary" role="button" (click)="update(s)">
                <span class="bi-save"></span> Save
              </button>
            </div>
          </form>
        </div>
      }
    }
  </div>
}
